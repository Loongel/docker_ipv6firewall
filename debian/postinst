#!/bin/bash
set -e

# 创建日志目录
mkdir -p /var/log
touch /var/log/docker-ipv6-firewall.log
chmod 644 /var/log/docker-ipv6-firewall.log

# 创建配置目录
mkdir -p /etc/docker-ipv6-firewall

# 如果配置文件不存在，复制默认配置
if [ ! -f /etc/docker-ipv6-firewall/config.yaml ]; then
    cp /usr/share/docker-ipv6-firewall/config.yaml /etc/docker-ipv6-firewall/
    chmod 644 /etc/docker-ipv6-firewall/config.yaml
fi

# 重新加载systemd
systemctl daemon-reload

# 启用服务
systemctl enable docker-ipv6-firewall.service

# 如果Docker正在运行，启动服务
if systemctl is-active --quiet docker; then
    systemctl start docker-ipv6-firewall.service
    echo "Docker IPv6 Firewall Manager 已启动"
else
    echo "Docker未运行，服务将在Docker启动后自动启动"
fi

echo "Docker IPv6 Firewall Manager 安装完成"
echo "配置文件: /etc/docker-ipv6-firewall/config.yaml"
echo "日志文件: /var/log/docker-ipv6-firewall.log"
echo "查看状态: systemctl status docker-ipv6-firewall"
echo "查看日志: journalctl -u docker-ipv6-firewall -f"

exit 0
